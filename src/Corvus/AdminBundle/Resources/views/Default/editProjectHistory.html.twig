{% extends 'CorvusAdminBundle:Default:adminBase.html.twig' %}

{% block mainContent %}

	<h2>Edit "{{ form.vars.value.projectName }} - {{ form.vars.value.role }}"</h2>
	<p>
		Use this form to update the project details.<br />
		Please enter all the fields, Alternate text is highly usefull for people with screenreaders :)
	</p>

	<form action="{{ path('CorvusAdminBundle_EditProjectHistory', {'id' : form.vars.value.id }) }}" method="post" {{ form_enctype(form) }} class="classy">
		<fieldset>
			<legend>Project History Fields:</legend>			 

    		<div>
                {{ form_label(form.project_name) }}
                <span class="asterix">*</span>
                {{ form_errors(form.project_name) }}
                {{ form_widget(form.project_name) }}
            </div>

            <div>
                {{ form_label(form.project_description) }}
                <span class="asterix">*</span>
                {{ form_errors(form.project_description) }}
                {{ form_widget(form.project_description) }}
            </div>

            <div>
                {{ form_label(form.role) }}
                <span class="asterix">*</span>
                {{ form_errors(form.role) }}
                {{ form_widget(form.role) }}
            </div>
    		{{ form_row(form.process) }}
    		{{ form_row(form.feedback_received) }}
    		{{ form_row(form.reflection) }}
    		{{ form_row(form.url) }}

		</fieldset>

		<fieldset>
			<legend>Images:</legend>
            <div id="projectHistory_images" data-prototype="{{ form_widget(form.images.vars.prototype) | e }}">
			{% for image in form.images %}
				{{ form_row(image) }}
				<img src="/uploads/{{ thumbnails[loop.index - 1] }}" />
			{% endfor %}

            <div><a href="#" id="add-another-image">Add an Image</a></div>
            </div>
		</fieldset>

        <fieldset>
            <legend>Meta Info:</legend>
            <div>
                {{ form_label(form.meta_title) }}
                <span class="asterix">*</span>
                {{ form_errors(form.meta_title) }}
                {{ form_widget(form.meta_title) }}
            </div>
            {{ form_row(form.meta_description) }}
        </fieldset>

		{{ form_row(form._token) }}
		

		<a href="{{ path('CorvusAdminBundle_ProjectHistory') }}" class="cancel">Cancel</a>
		&nbsp;
		<input type="submit" class="submit" value="Submit" />
	
        <script type="text/javascript">
            // keep track of how many email fields have been rendered
            var emailCount = '{{ form.images | length }}';

            jQuery(document).ready(function() {

                // Find all current images
                var children = jQuery('#projectHistory_images').children('div').children('label');

                // Add "Image" before each image number
                $.each(children, function(index, value){
                    var oldHtml = this.innerHTML;
                    var newHtml = "Image " + oldHtml;
                    this.innerHTML = newHtml;
                    
                });

                jQuery('#add-another-image').click(function() {
                    var emailList = jQuery('#projectHistory_images');

                    // grab the prototype template
                    var newWidget = '<label class="required">Image ' + emailCount.toString() + '</label>';
                    newWidget += emailList.attr('data-prototype');
                    // replace the "__name__" used in the id and name of the prototype
                    // with a number that's unique to our emails
                    // end name attribute looks like name="contact[emails][2]"
                    newWidget = newWidget.replace(/__name__/g, emailCount);
                    emailCount++;

                    // create a new list element and add it to our list
                    var newLi = jQuery('<div></div>').html(newWidget);
                    newLi.append("<hr /><br />");
                    $('#add-another-image').parent().before(newLi);

                    return false;
                });
            });
        </script>

	</form>

{% endblock %}